<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>แกลเลอรี CNC และ Preorder วัสดุ CNC</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Google Fonts: Prompt -->
    <link
      href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
    <style>
      body {
        font-family: "Prompt", sans-serif;
        background-color: #f8f9fa;
      }

      .navbar {
        background-color: #111175;
      }

      header {
        background-color: #111175;
        padding: 20px 0;
      }

      header h1 {
        margin: 0;
        font-size: 2.5rem;
      }

      .album {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      .card:hover {
        transform: none;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container px-2">
        <a class="navbar-brand" href="#">
          <img src="./logo.png" alt="Logo" style="height: 40px" />
        </a>
        <span style="color: #f8f9fa">ห้างหุ้นส่วนจำกัด รินทร์ศิลป์ โฆษณา</span>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="promotion.html">โปรโมชั่น</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="materials.html">วัสดุ</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="gallery.html">ผลงานของเรา</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="preorder.html">สั่งทำสินค้า</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="check-order.html">รายการสั่งทำ</a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdown"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                ><span id="userName">User</span></a
              >
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                <li>
                  <a
                    class="dropdown-item"
                    href="login.html"
                    id="login-button"
                    style="display: none"
                    >เข้าสู่ระบบ</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="#" id="logout-button"
                    >ออกจากระบบ</a
                  >
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <header class="text-white text-center py-4">
      <h1>ประเมินราคาก่อนสั่งทำสินค้า</h1>
    </header>

    <section class="container py-5">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="card shadow-sm">
            <div class="card-body">
              <h3 class="card-title text-center mb-4">
                แบบประเมินราคา
              </h3>
              <form id="estimateForm">
                <div class="mb-3">
                  <label for="estimateMaterial" class="form-label"
                    >วัสดุที่เลือก <span class="text-danger">*</span></label
                  >
                  <select class="form-select" id="estimateMaterial" required></select>
                </div>
                <div class="mb-3">
                  <label for="estimateQuantity" class="form-label"
                    >จำนวน <span class="text-danger">*</span></label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="estimateQuantity"
                    placeholder="กรุณาระบุจำนวน"
                    required
                    onkeypress="return event.charCode >= 48 && event.charCode <= 57"
                    oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                  />
                </div>
                <div class="text-center">
                  <button type="submit" class="btn btn-primary">
                    คำนวณราคา
                  </button>
                </div>
              </form>
              <div id="estimateResult" class="mt-4 text-center" style="display: none;">
                <h4>ราคาประเมิน</h4>
                <p id="estimatedPrice"></p>
                <button class="btn btn-primary" id="proceedToOrder">
                  ไปยังแบบฟอร์มสั่งทำสินค้า
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="container py-5" id="preorderSection" style="display: none;">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="card shadow-sm">
            <div class="card-body">
              <h3 class="card-title text-center mb-4">
                แบบฟอร์มการสั่งทำสินค้า
              </h3>
              <form id="preorderForm">
                <!-- ฟอร์มการสั่งทำสินค้า -->
                <div class="mb-3">
                  <label for="orderMaterial" class="form-label"
                    >วัสดุที่เลือก</label
                  >
                  <input type="text" class="form-control" id="orderMaterial" readonly />
                </div>
                <div class="mb-3">
                  <label for="orderQuantity" class="form-label">จำนวน</label>
                  <input type="text" class="form-control" id="orderQuantity" readonly />
                </div>
                <div class="mb-3">
                  <label for="orderEstimatedPrice" class="form-label">ราคาโดยประมาณ</label>
                  <input type="text" class="form-control" id="orderEstimatedPrice" readonly />
                </div>
                <!-- สามารถเพิ่มฟอร์มข้อมูลอื่นๆ ตามต้องการ -->
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        const materialsSelect = document.getElementById("estimateMaterial");
        const estimateForm = document.getElementById("estimateForm");
        const estimateResult = document.getElementById("estimateResult");
        const estimatedPrice = document.getElementById("estimatedPrice");
        const proceedToOrderButton = document.getElementById("proceedToOrder");
        const preorderSection = document.getElementById("preorderSection");
        const orderMaterial = document.getElementById("orderMaterial");
        const orderQuantity = document.getElementById("orderQuantity");
        const orderEstimatedPrice = document.getElementById("orderEstimatedPrice");
        let materials = [];

        try {
          const response = await fetch("/api/materials");
          if (!response.ok) throw new Error("Failed to fetch materials.");
          materials = await response.json();

          materials.forEach((material) => {
            const option = document.createElement("option");
            option.value = material._id;
            option.textContent = `${material.name} - ${material.size} - ${material.thickness} - ${material.price} บาท`;
            materialsSelect.appendChild(option);
          });
        } catch (error) {
          console.error("Error loading materials:", error);
        }

        estimateForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const selectedMaterialId = document.getElementById("estimateMaterial").value;
          const quantity = document.getElementById("estimateQuantity").value;
          const selectedMaterial = materials.find((material) => material._id === selectedMaterialId);
          const price = selectedMaterial.price * quantity;
          estimatedPrice.textContent = `ราคาโดยประมาณ: ${price} บาท`;
          estimateResult.style.display = "block";
        });

        proceedToOrderButton.addEventListener("click", () => {
          const selectedMaterialId = document.getElementById("estimateMaterial").value;
          const quantity = document.getElementById("estimateQuantity").value;
          const selectedMaterial = materials.find((material) => material._id === selectedMaterialId);
          const price = selectedMaterial.price * quantity;

          // ส่งข้อมูลไปยังฟอร์มสั่งทำสินค้า
          orderMaterial.value = selectedMaterial.name;
          orderQuantity.value = quantity;
          orderEstimatedPrice.value = price;

          estimateResult.style.display = "none";
          preorderSection.style.display = "block";
        });
      });
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
